{% extends "saaf/base.html" %}

{% block title %}
  {{ event.title }} – Event Details
{% endblock title %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 py-6 space-y-6">

  <!-- Event Info -->
  <div class="bg-white rounded-lg shadow p-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-2">{{ event.title }}</h2>
    <p class="text-gray-700 mb-4">{{ event.description }}</p>
    <p class="text-sm text-gray-600"><strong>Date:</strong> {{ event.date|date:"M d, Y H:i" }}</p>
    <p class="text-sm text-gray-600"><strong>Location:</strong> {{ event.location_name }}</p>
  </div>

  <!-- Participants -->
  <div class="bg-white rounded-lg shadow p-6">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Participants</h3>
    {% if participants %}
      <ul class="list-disc list-inside text-gray-700 space-y-1">
        {% for p in participants %}
          <li>{{ p.user.username }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-gray-500">No participants yet.</p>
    {% endif %}
  </div>

  <!-- Action Controls -->
  <div class="bg-white rounded-lg shadow p-6">
    {% if not is_past %}
    {% if request.user == event.post.author %}
      <a href="{% url 'delete-event' event.pk %}" onclick="return confirm('Are you sure you want to delete this event?');"
         class="text-red-600 hover:underline text-sm">Delete Event</a>
    {% else %}
      {% if user_has_joined %}
        <form method="post" action="{% url 'event-cancel' event.pk %}" class="mt-2">
          {% csrf_token %}
          <button type="submit" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">Cancel Participation</button>
        </form>
      {% else %}
        <form method="post" action="{% url 'event-join' event.pk %}" class="mt-2">
          {% csrf_token %}
          <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">Join Event</button>
        </form>
      {% endif %}
    {% endif %}
    {% else %}
    <p class="text-sm text-gray-500 italic">This event has already occurred.</p>
    {% endif %}
  </div>

  <!-- Back Link -->
  <div>
    <a href="{% url 'post-detail' event.post.pk %}" class="text-blue-600 hover:underline text-sm">← Back to Post</a>
  </div>

</div>
{% endblock content %}
